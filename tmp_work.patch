diff --git a/common/CMakeLists.txt b/common/CMakeLists.txt
index 706fa32e..00e82fe1 100644
--- a/common/CMakeLists.txt
+++ b/common/CMakeLists.txt
@@ -79,8 +79,8 @@ if (BUILD_SHARED_LIBS)
     set_target_properties(${TARGET} PROPERTIES POSITION_INDEPENDENT_CODE ON)
 endif()
 
-# TODO: use list(APPEND LLAMA_COMMON_EXTRA_LIBS ...)
-set(LLAMA_COMMON_EXTRA_LIBS build_info)
+set(LLAMA_COMMON_PRIVATE_LIBS build_info)
+set(LLAMA_COMMON_PUBLIC_LIBS "")
 
 if (LLAMA_CURL)
     # Use curl to download model url
@@ -90,11 +90,11 @@ if (LLAMA_CURL)
     endif()
     target_compile_definitions(${TARGET} PUBLIC LLAMA_USE_CURL)
     include_directories(${CURL_INCLUDE_DIRS})
-    set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} ${CURL_LIBRARIES})
+    list(APPEND LLAMA_COMMON_PUBLIC_LIBS ${CURL_LIBRARIES})
 elseif (LLAMA_HTTPLIB)
     # otherwise, use cpp-httplib
     target_compile_definitions(${TARGET} PUBLIC LLAMA_USE_HTTPLIB)
-    set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} cpp-httplib)
+    list(APPEND LLAMA_COMMON_PUBLIC_LIBS cpp-httplib)
 endif()
 
 if (LLAMA_LLGUIDANCE)
@@ -138,12 +138,14 @@ if (LLAMA_LLGUIDANCE)
 
     target_include_directories(${TARGET} PRIVATE ${LLGUIDANCE_PATH})
     # Add platform libraries to the main target
-    set(LLAMA_COMMON_EXTRA_LIBS ${LLAMA_COMMON_EXTRA_LIBS} llguidance ${LLGUIDANCE_PLATFORM_LIBS})
+    list(APPEND LLAMA_COMMON_PUBLIC_LIBS llguidance ${LLGUIDANCE_PLATFORM_LIBS})
 endif ()
 
 target_include_directories(${TARGET} PUBLIC . ../vendor)
 target_compile_features   (${TARGET} PUBLIC cxx_std_17)
-target_link_libraries     (${TARGET} PRIVATE ${LLAMA_COMMON_EXTRA_LIBS} PUBLIC llama Threads::Threads)
+target_link_libraries     (${TARGET}
+    PRIVATE ${LLAMA_COMMON_PRIVATE_LIBS}
+    PUBLIC llama Threads::Threads ${LLAMA_COMMON_PUBLIC_LIBS})
 
 
 #
diff --git a/tools/run/run.cpp b/tools/run/run.cpp
index b90a7253..75120de8 100644
--- a/tools/run/run.cpp
+++ b/tools/run/run.cpp
@@ -23,10 +23,14 @@
 
 #if defined(LLAMA_USE_CURL)
 #    include <curl/curl.h>
-#else
+#elif defined(LLAMA_USE_HTTPLIB)
 #    include "http.h"
 #endif
 
+#if !defined(LLAMA_USE_CURL)
+using curl_off_t = long long; // fallback for progress helpers when cURL is unavailable
+#endif
+
 #include <signal.h>
 
 #include <climits>
@@ -430,7 +434,7 @@ class HttpClient {
         return 0;
     }
 
-#ifdef LLAMA_USE_CURL
+#if defined(LLAMA_USE_CURL)
 
     ~HttpClient() {
         if (chunk) {
@@ -536,9 +540,7 @@ class HttpClient {
         return curl_easy_perform(curl);
     }
 
-#else // LLAMA_USE_CURL is not defined
-
-#define curl_off_t long long  // temporary hack
+#elif defined(LLAMA_USE_HTTPLIB)
 
   private:
     // this is a direct translation of the cURL download() above
@@ -645,6 +647,15 @@ class HttpClient {
         return 0;
     }
 
+#else
+
+  private:
+    int download(const std::string &, const std::vector<std::string> &, const std::string &, const bool,
+                 std::string *) {
+        printe("HTTP downloads are disabled in this build (LLAMA_CURL=OFF, LLAMA_HTTPLIB=OFF).\n");
+        return 1;
+    }
+
 #endif // LLAMA_USE_CURL
 
     static std::string human_readable_time(double seconds) {
